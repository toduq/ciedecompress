# ciede-compress

CIEDE2000という色差式を用いて、  
画像のピクセルのうち人間が識別できない程度に近い色を同一色に塗りつぶすことによって、  
後続の画像圧縮の効率を向上させることを目的としたフィルタ。  
不可逆変換であり、このフィルタ自身が圧縮を行うわけではない。


## CIEDE2000とは
人間の視覚のうち色の変化を感じ取る能力は、色相や彩度などに依存して変化するため、  
これらを考慮することでより劣化を感じさせないまま、不要な情報を削除する。  
たとえば、人間は黄色に比べて緑色の色相の変化を感じにくい。  
この色相や彩度の依存性を定式化したものがCIEDE2000である。

http://www.konicaminolta.jp/instruments/knowledge/color/part5/02.html


## 実装について

### CIEDE2000の計算

CIEDE2000の計算式についてはWikipediaにて確認することができる。  
https://en.wikipedia.org/wiki/Color_difference#CIEDE2000

また、実装の正しさの検証のための参考値が以下の論文から確認できる。  
http://www.ece.rochester.edu/~gsharma/ciede2000/ciede2000noteCRNA.pdf

元となる画像の色はRGBであるため、これをXYZ形式、L\*a\*b\*形式に変換したうえで計算する。

この処理が、`color/color.go` に含まれている。

### ピクセルの塗りつぶし

ピクセルを特定の大きさ(デフォルトでは8ピクセル)の正方形に切り取り、これをチャンクと呼ぶ。  
このチャンクについて相互に⊿Eを計算する。  
特定のしきい値(デフォルトでは1.0)を下回るものについてピックアップし、  
最も他のピクセルとの重複の多いピクセルの色で、対応するピクセルを塗りつぶす。  
そしてピックアップしたリストから、今塗りつぶしたピクセルを全て除外した後、  
再び、最も他のピクセルとの重複の多いピクセルを探し、同じ処理を繰り返す。  
しきい値を下回るピクセルの組がなくなった時点で、このチャンクに対する操作を終了し、  
次のチャンクを取り出し、同様の操作を行う。

この処理が、 `main.go` に含まれている。

## 実行方法

### 方法1. バイナリを直接ダウンロードする

https://github.com/toduq/ciedecompress/releases  
こちらのページより、`ciedecompress_linux_amd64` をダウンロードして、直接実行します。  
名前の通り、Linux 64Bit環境向けにコンパイルされています。

### 方法2. コンパイルする

Go言語の環境を整えたうえで、  
`go get github.com/toduq/ciedecompress`  
を実行すると、`$GOROOT/bin/ciedecompress` が作成され、実行可能になります。


## 検証

[sample/README.md](/sample/README.md)

## 本リポジトリに含まれている画像

本リポジトリに含まれている画像についてはすべて、
[pixabay](https://pixabay.com/ja/)に掲載されている、CC0の画像を用いている。
